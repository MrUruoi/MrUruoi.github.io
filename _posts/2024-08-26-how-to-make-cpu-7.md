---
layout: post
title: CPU 만들기 (7)
subtitle: 프로그램 카운터
author: gonayun
categories: etc.
tags: CPU cpuの創りかた TD4 Program_counter
sidebar: []
---

현재 명령의 위치(Address)를 가리키는 역할을 하는 것이 프로그램 카운터(Program Counter)입니다.\
즉, 프로그램 카운터의 값이 0001이라면 0001번지의 명령을 실행하게 되는 것입니다.

## 프로그램 카운터는 언제 카운터업을 하는가

명령은 위에서부터 순서대로 실행됩니다. 따라서 한 명령을 실행할 때마다 프로그램 카운터를 단순히 +1 하면 됩니다.
(만약 2개 또는 3개의 번지에 걸치는 명령이 있다면 그에 따라 +2나 +3을 해야 하므로 조금 번거로울 수 있지만, TD4에서는 명령의 길이가 고정되어 있어 항상 하나의 번지에 하나의 명령이 저장됩니다.)

TD4의 프로그램 카운터에 필요한 기능은 다음 2가지 뿐입니다.
* 리셋 신호에 의해 0으로 리셋
* 1클록 마다 +1(카운트 업)

여기서는 D레지스터(74HC161)을 프로그램 카운터로 사용합니다. (ENT, ENP)\
이 프로그램 카운터를 ROM에 연결하면 ROM로부터 명령을 가져올 수 있게 됩니다.

## 프로그램 카운터의 동작

1. 리셋
2. 리셋이 되었으므로 프로그램 카운터는 0000입니다.
3. 0000가　번지(Adress)로 출력됩니다.
4. ROM의 0000번지 확인
5. 0000번지의 명령이 출력
6. 명령 완료 (1클록 종료)
7. 프로그램 카운터가 +1 (0001)
8. 0001가 번지(Adress)로 출력됩니다.
9. ROM의 0001번지 확인
10. 0001번지의 명령이 출력
11. ...

## 점프 명령

**JMP Im** 은 **MOV PC, Im** 과 같습니다.\
즉, 점프 명령은 일반적인 전송 명령입니다.

## 조건 분기

TD4의 조건 명령은 **JNC Im** 하나뿐입니다. 간단히 설명하면\
**C플래그가 0이면 점프**
**C플래그가 1이면 아무것도 하지 않음**
이므로 C플래그(74HC74)를 프로그램 카운터에 연결할 필요가 있습니다.
